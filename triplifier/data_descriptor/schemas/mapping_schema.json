{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/MaastrichtU-CDS/Flyover/triplifier/data_descriptor/schema_handling/validation_schema.json",
  "title": "Flyover Semantic Mapping Schema",
  "description": "JSON Schema for validating Flyover JSON-LD semantic mapping files with variable schema definitions",
  "type": "object",
  "required": [
    "@context",
    "@type",
    "schema",
    "databases"
  ],
  "properties": {
    "@context": {
      "description": "JSON-LD context defining prefixes and term mappings",
      "type": "object",
      "required": [
        "@vocab"
      ],
      "properties": {
        "@vocab": {
          "type": "string",
          "format": "uri"
        }
      },
      "additionalProperties": {
        "oneOf": [
          {
            "type": "string"
          },
          {
            "type": "object"
          }
        ]
      }
    },
    "@id": {
      "description": "Unique identifier URI for this mapping",
      "type": "string"
    },
    "@type": {
      "description": "Type of this document",
      "type": "string",
      "pattern": "^(mapping:)?DataMapping$",
      "enum": [
        "mapping:DataMapping",
        "DataMapping"
      ]
    },
    "name": {
      "description": "Human-readable name for this mapping",
      "type": "string",
      "minLength": 1
    },
    "description": {
      "description": "Description of this mapping",
      "type": "string"
    },
    "version": {
      "description": "Version of this mapping file",
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "created": {
      "description": "Creation date in YYYY-MM-DD format",
      "type": "string",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
    },
    "endpoint": {
      "description": "SPARQL endpoint URL",
      "type": "string"
    },
    "schema": {
      "$ref": "#/definitions/SemanticSchema"
    },
    "databases": {
      "description": "Database definitions containing tables and column mappings",
      "type": "object",
      "minProperties": 1,
      "additionalProperties": {
        "$ref": "#/definitions/Database"
      }
    }
  },
  "additionalProperties": true,
  "definitions": {
    "SemanticSchema": {
      "description": "Embedded semantic schema defining variables, predicates, classes, and value mappings",
      "type": "object",
      "required": [
        "@type",
        "variables"
      ],
      "properties": {
        "@id": {
          "type": "string"
        },
        "@type": {
          "type": "string",
          "pattern": "^(schema:)?SemanticSchema$",
          "enum": [
            "schema:SemanticSchema",
            "SemanticSchema"
          ]
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "description": {
          "type": "string"
        },
        "prefixes": {
          "$ref": "#/definitions/Prefixes"
        },
        "variables": {
          "description": "Variable definitions - keys are variable identifiers, structure varies per schema",
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/definitions/SchemaVariable"
          }
        }
      },
      "additionalProperties": true
    },
    "Prefixes": {
      "description": "Namespace prefix definitions",
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "format": "uri"
      }
    },
    "SchemaVariable": {
      "description": "A variable definition in the semantic schema",
      "type": "object",
      "required": [
        "@type",
        "dataType",
        "predicate",
        "class"
      ],
      "properties": {
        "@id": {
          "description": "Unique identifier for this variable",
          "type": "string"
        },
        "@type": {
          "description": "Variable type classification",
          "type": "string",
          "pattern": "^(schema:)?(IdentifierVariable|CategoricalVariable|ContinuousVariable|OrdinalVariable|DateVariable|TextVariable)$",
          "enum": [
            "schema:IdentifierVariable",
            "schema:CategoricalVariable",
            "schema:ContinuousVariable",
            "schema:OrdinalVariable",
            "schema:DateVariable",
            "schema:TextVariable"
          ]
        },
        "dataType": {
          "description": "Data type of the variable",
          "type": "string",
          "enum": [
            "identifier",
            "categorical",
            "continuous",
            "ordinal",
            "date",
            "text"
          ]
        },
        "predicate": {
          "description": "RDF predicate (property) for this variable",
          "type": "string",
          "minLength": 1
        },
        "class": {
          "description": "RDF class (concept) for this variable",
          "type": "string",
          "minLength": 1
        },
        "schemaReconstruction": {
          "description": "Schema reconstruction rules for graph structure",
          "type": "array",
          "items": {
            "$ref": "#/definitions/SchemaReconstructionNode"
          }
        },
        "valueMapping": {
          "description": "Mapping of categorical values to ontology classes",
          "$ref": "#/definitions/SchemaValueMapping"
        }
      },
      "additionalProperties": true
    },
    "SchemaReconstructionNode": {
      "description": "A node in the schema reconstruction chain",
      "type": "object",
      "required": [
        "@type",
        "predicate",
        "class"
      ],
      "properties": {
        "@type": {
          "type": "string",
          "pattern": "^(schema:)?(ClassNode|UnitNode|PropertyNode)$"
        },
        "placement": {
          "description": "Placement directive for this node",
          "type": "string",
          "enum": [
            "before",
            "after"
          ]
        },
        "predicate": {
          "type": "string",
          "minLength": 1
        },
        "class": {
          "type": "string",
          "minLength": 1
        },
        "classLabel": {
          "description": "Label for referencing this class in code",
          "type": "string"
        },
        "nodeLabel": {
          "description": "Label for referencing this node in code",
          "type": "string"
        },
        "aestheticLabel": {
          "description": "Human-readable display label",
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "SchemaValueMapping": {
      "description": "Value mapping definition containing terms",
      "type": "object",
      "required": [
        "terms"
      ],
      "properties": {
        "terms": {
          "description": "Term mappings - keys are canonical term names, values define target classes",
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/SchemaTermMapping"
          }
        }
      },
      "additionalProperties": true
    },
    "SchemaTermMapping": {
      "description": "A single term mapping to an ontology class",
      "type": "object",
      "required": [
        "targetClass"
      ],
      "properties": {
        "targetClass": {
          "description": "Target ontology class for this term",
          "type": "string",
          "minLength": 1
        }
      },
      "additionalProperties": true
    },
    "Database": {
      "description": "A database containing one or more tables",
      "type": "object",
      "required": [
        "@type",
        "tables"
      ],
      "properties": {
        "@id": {
          "type": "string"
        },
        "@type": {
          "type": "string",
          "pattern": "^(mapping:)?Database$",
          "enum": [
            "mapping:Database",
            "Database"
          ]
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "locale": {
          "description": "Locale code for this database (e.g., en_GB, hi_IN, nl_NL)",
          "type": "string",
          "pattern": "^[a-z]{2}_[A-Z]{2}$"
        },
        "endpoint": {
          "description": "Optional database-specific endpoint override",
          "type": "string"
        },
        "tables": {
          "description": "Tables in this database",
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/definitions/Table"
          }
        }
      },
      "additionalProperties": true
    },
    "Table": {
      "description": "A table containing column mappings",
      "type": "object",
      "required": [
        "@type",
        "columns"
      ],
      "properties": {
        "@id": {
          "type": "string"
        },
        "@type": {
          "type": "string",
          "pattern": "^(mapping:)?Table$",
            "enum": [
                "mapping:Table",
                "Table"
            ]
        },
        "sourceFile": {
          "description": "Source file name or path",
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "columns": {
          "description": "Column mappings - keys should reference variables defined in schema",
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/definitions/ColumnMapping"
          }
        }
      },
      "additionalProperties": true
    },
    "ColumnMapping": {
      "description": "A column mapping linking local data to schema variables",
      "type": "object",
      "required": [
        "mapsTo",
        "localColumn"
      ],
      "properties": {
        "mapsTo": {
          "description": "Reference to schema variable (e.g., schema:variable/biological_sex)",
          "type": "string",
          "pattern": "^schema:variable/.+$"
        },
        "localColumn": {
          "description": "Local column name in source data",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "localMappings": {
          "description": "Local value mappings - keys are schema terms, values are local terms (string or array of strings)",
          "type": "object",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              },
              {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            ]
          }
        }
      },
      "additionalProperties": true
    }
  }
}
